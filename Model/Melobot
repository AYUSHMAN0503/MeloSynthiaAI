import spacy
from spacy.matcher import Matcher

# Load a spaCy language model (e.g., English)
nlp = spacy.load("en_core_web_sm")

# Define some pattern-response pairs for the chatbot
patterns = [
    (r'(hi|hello|hey)', ['Hello!', 'Hi there!', 'Hey!']),
    (r'(what can you do)', ['I can help you with music recommendation', 'I can tell you about NFTs', 'I am but a robot after all']),
    (r'(how are you)', ['I am good, thank you!', 'I am just a chatbot, but I am fine.']),
    (r'what can you do', ['I can help you generate music, create NFTs of generated lyrics, and provide music-related recommendations. Just ask me!']),
    (r'how can I generate music', [" You can generate music by giving a prompt text as an input and selecting your preferences and then simply press enter. The music+lyrics will generate automatically afterwards."]),
    (r'how can I make nfts of my generated lyrics', ["After generating, By simply clicking on the nft button you can make it as an NFT and list them in our marketplace."]),
    (r'give me an example prompt for how can I generate professional tunes', [" Various prompt examples are:\n1. A 90's pop culture music with drum beats\n2. American style beats with Indian music\n3. Taylor Swift's style of lyrics on ambient music tunes"]),
    (r'(.*)', ["I'm sorry, I don't understand. You can ask me about generating music or for general information."]),
]

# Create a spaCy Matcher for pattern matching
matcher = Matcher(nlp.vocab)

for pattern, responses in patterns:
    pattern_tokens = [{"TEXT": {"REGEX": pattern}}]
    matcher.add(pattern, None, pattern_tokens)

# Function to chat with the user
def chat_with_user():
    print("Melobot: Hi there! I'm Melobot. How can I help you today?")
    while True:
        user_input = input("You: ")
        if user_input.lower() == 'exit':
            print("Melobot: Goodbye!")
            break
        else:
            doc = nlp(user_input)
            matches = matcher(doc)
            if matches:
                match_id, _, _ = matches[0]
                response = responses
            else:
                response = ["I'm sorry, I don't understand. You can ask me about generating music, making NFTs, or for general information."]
            print("Melobot:", response[0])

# Start the chat with the user
if __name__ == "__main__":
    chat_with_user()
